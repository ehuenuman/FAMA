{% extends 'teacher/base.html' %}
{% load staticfiles %}

{% block extracss%}
  <link rel="stylesheet" href="{% static 'css/library/c3.min.css' %}">
  <style>
    .reply {
      border-radius: 0px;
    }

    .reply.correct {
      background-color: #4caf50;
    }

    .reply.incorrect {
      background-color: #f44336;
    }
  </style>
{% endblock %}

{% block extrajs%}
  <script type="text/javascript" src="{% static 'js/play.result.charts.js' %}"></script>
  <script type="text/javascript" src="{% static 'js/library/d3.min.js' %}"></script>
  <script type="text/javascript" src="{% static 'js/library/c3.min.js' %}"></script>
{% endblock %}

{% block title %}
FAMA - Resultados Formativa
{% endblock %}

{% block page-title %}
Resultados
{% endblock %}


{% block content %}
<div class="row last-row">
  <div class="col s12 m4 l4">
    <ul class="collection">
      <li class="collection-item col s12">
        <div class="list-group">
          <div class="list-group-item truncate">
            <i class="fa fa-file-o" aria-hidden="true"></i>&nbsp;{{play.formative.name}}
          </div>
          <div class="list-group-item truncate">
            <i class="fa fa-users" aria-hidden="true"></i>&nbsp;{{play.course.code}} - {{play.course.name}}
          </div>
          <div class="list-group-item truncate">
            <i class="fa fa-clock-o" aria-hidden="true"></i>&nbsp;{{play.duration_to_time}}
          </div>
          <div class="list-group-item truncate">
            <i class="fa fa-calendar-times-o" aria-hidden="true"></i>&nbsp;{{play.close_play|date:"D d/M/Y"}}
          </div>
        </div>
      </li>
    </ul>
  </div>
  <div class="col s12 m4 l4">
    <ul class="collection with-header">
      <li class="collection-header col s12 center-align"><b>Iniciaron la formativa</b></li>
      <li class="collection-item col s12 center-align" id="students_play_chart">
        
      </li>
    </ul>
  </div>
  <div class="col s12 m4 l4">
    <ul class="collection">
      <li class="collection-item col s12"></li>
    </ul>
  </div>
</div>

<div class="row">
  <div class="col s12 m6">
    <ul class="tabs">
      <li class="tab col s6">
        <a class="active" href="#table_result">
          <i class="fa fa-table fa-lg" aria-hidden="true"></i>
          <span class="hide-on-small-only">&nbsp;Tabla general</span>
        </a>
      </li>
      <li class="tab col s6 disabled">
        <a href="#plots_result">
          <i class="fa fa-pie-chart fa-lg" aria-hidden="true"></i>
          <span class="hide-on-small-only">&nbsp;Est&iacute;sticas</span>          
        </a>
      </li>
    </ul>
  </div>


  <div class="col s12" id="table_result">
    <div style="overflow-x: auto;">
      <table class="card-box" style="font-size: 13px; margin-top: 0px;">
        <thead>          
          <tr>
            <th class="hide-on-med-and-down" style="width: 90px;">RUT</th>
            <th style="width: 250px;">Estudiante</th>
            {% for question in questions %}
              <th class="center-align" data-question="{{ question.id }}">P{{ forloop.counter }} {{ question.title|truncatechars_html:20 }}</th>
            {% endfor %}
            <th class="center-align" style="width: 100px;">Total</th>
          </tr>
        </thead>
        <tbody>          
          {% for student in students %}
            <tr>
              <td class="hide-on-med-and-down">{{ student.username }}</td>
              <td class="truncate" data-student="{{ student.id }}">{{ student.first_name|title }} {{ student.last_name|title }}</td>
              {% for question in questions %}
                <td data-student="{{ student.id }}" data-question="{{ question.id }}"
                  {% for answer in student.answers %}        
                    {% if answer.question == question.id %}
                      {% if answer.correct == 1 %}
                         class="center-align reply correct">
                          <i class="fa fa-check fa-lg" aria-hidden="true"></i>
                      {% else %}
                        class="center-align reply incorrect">
                          <i class="fa fa-times fa-lg" aria-hidden="true"></i>
                      {% endif %}
                    {% endif %}
                  {% endfor %} 
                  </td>
              {% endfor %}
              <td class="center-align">{{ student.corrects }}</td>
            </tr>
          {% endfor %}
          <tr>
            <td class="hide-on-med-and-down"></td>
            <td><b>Total</b></td>
            {% for question in questions %}
              <td class="center-align" data-question="{{ question.id }}">
              {% for total in total_for_question %}
                {% if total.question == question.id %}
                  <div class="col s12 corrects">
                    <i class="fa fa-check" aria-hidden="true"></i>&nbsp;<span>{{ total.corrects }}</span>
                  </div>
                  <div class="col s12 incorrects">
                    <i class="fa fa-times" aria-hidden="true"></i>&nbsp;<span>{{ total.incorrects }}</span>
                  </div>                  
                {% endif %}
              {% endfor %}
              </td>
            {% endfor %}
            <td></td>
          </tr>
        </tbody>
      </table>
    </div>    
  </div>

  <div class="col s12" id="plots_result">
  </div>
</div>
{% endblock %}

{% block footer %}
{% endblock %}

{% block js %}
<script>
  $(document).ready(function(){
    $('ul.tabs').tabs();
  });

  //Conect socket
  var ws_scheme = window.location.protocol == "https:" ? "wss" : "ws";
  var ws_url = ws_scheme + "://" + window.location.hostname + ":2412" + "/ws/play/" 
  + window.location.pathname.split("/")[3] + "/" + "?session_key={{request.session.session_key}}";  

  var socket = new WebSocket(ws_url);

  //Set up charts
  played_formative_chart({{course.student.count}}, {{started_play}});
</script>
<script type="text/javascript" src="{% static 'js/play.result.socket.js' %}"></script>
{% endblock %}